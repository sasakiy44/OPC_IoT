# Ultrasonic Distance Sensor with LED Indicators（日本語版）

このプロジェクトは、MicroPython対応のマイクロコントローラ（例: Raspberry Pi Pico または ESP32）上で、HC-SR04超音波センサを使用して距離を測定し、測定された距離に基づいて3つのLED（赤、黄、緑）を制御します。

## 概要

プログラムはHC-SR04センサを使用して物体までの距離を測定します：
- 距離が10 cm未満の場合: 赤LEDを点灯（近距離）。
- 距離が10 cmから50 cmの場合: 黄LEDを点灯（中距離）。
- 距離が50 cmを超える場合: 緑LEDを点灯（遠距離）。

LEDはループで点灯し、割り込み（例: CTRL-C）が入るまで続き、その時点で全てのLEDをオフにします。

## ハードウェア要件

- MicroPython対応のマイクロコントローラ（例: Raspberry Pi Pico）。
- HC-SR04超音波センサ。
- 3つのLED（赤、黄、緑）と適切な抵抗器。
- ブレッドボードとジャンパーワイヤー。

## 各ファイルについて

- OPC_001.py: カスタマイズ済み完成品
- OPC_custom_blink.py: 赤色LEDを点滅させるためのカスタムコード
- OPC_custom_message.py: Pythonプロンプトに表示されるメッセージを変更するカスタムコード
- OPC_student_handouts.py: 体験授業を受講者が最初に開いているコード
- README.md: 本文書

### ピン接続

- **超音波センサ (HC-SR04)**:
  - VCC: 5Vに接続。
  - Trig: GPIO5に接続。
  - Echo: GPIO18に接続。
  - GND: GNDに接続。

- **LED**:
  - 赤LED: GPIO4に接続（抵抗器を介してGNDに）。
  - 緑LED: GPIO0に接続（抵抗器を介してGNDに）。
  - 黄LED: GPIO15に接続（抵抗器を介してGNDに）。

**注意**: センサに安定した5V電源を供給してください。LEDには電流制限抵抗器（例: 220Ω）を使用して損傷を防いでください。

## ソフトウェア要件

- マイクロコントローラにMicroPythonファームウェアをインストール。
- 組み込みの`machine`および`time`モジュール以外に追加ライブラリは不要。

## インストール

1. MicroPythonをマイクロコントローラにインストール（[micropython.org](https://micropython.org/)からダウンロードし、Thonnyやrshellなどのツールでフラッシュ）。
2. マイクロコントローラをUSBでコンピュータに接続。
3. 提供されたPythonスクリプト（例: `main.py`）をThonnyやrshellなどのIDEを使用してマイクロコントローラのファイルシステムにコピー。

## 使用方法

1. スクリプトをマイクロコントローラにアップロード。
2. スクリプトを実行（ブート時に`main.py`という名前であれば自動起動）。
3. プログラムは距離を継続的に測定し、適切なLEDを点灯。
4. REPLでCTRL-Cを押してプログラムを停止し、全てのLEDをオフ。
5. アプリケーションに応じてコード内の閾値（例: `< 10`、`10-50`、`> 50`）を調整。

### 出力例

実行中、コンソールに距離が表示されます：
```
距離: 35.50 cm
```
中距離の場合、黄LEDが点灯します。

## コード説明

スクリプトの内容：
- **LED設定**: 赤（4）、緑（0）、黄（15）のピンを出力として設定。
- **センサ設定**: Trig（5）を出力、Echo（18）を入力として設定。
- **距離測定**: Trigからパルスを送信、`machine.time_pulse_us`を使用してエコー持続時間を測定、距離を計算（音速 ≈ 0.0343 cm/µs）。
- **LED制御**: 全てのLEDをオフにした後、距離閾値に基づいて1つを点灯。
- **エラー処理**: 測定失敗時はエラーを出力し、LEDをオフ。
- **ループ**: 0.5秒ごとに実行。KeyboardInterruptでクリーンアップ。


## トラブルシューティング

- **距離が測定されない**: センサの接続と電源を確認。センサの前に障害物がないか確認。
- **測定が不正確**: 温度/湿度に基づいて音速定数（0.0343）を校正。
- **LEDが点灯しない**: ピン番号と抵抗値を確認。
- **REPLでのエラー**: MicroPythonが正しくインストールされ、スクリプトにエラーがないことを確認。
